import { MCPBlinkMemoryServer } from '../../src/server/index';\nimport { autoTagService } from '../../src/core/auto-tag-service/index';\n\ndescribe('Auto-Tagging Integration', () => {\n  let server: MCPBlinkMemoryServer;\n\n  beforeAll(async () => {\n    server = new MCPBlinkMemoryServer();\n    await server.start();\n  });\n\n  afterAll(async () => {\n    await server.stop();\n  });\n\n  test('should generate and persist auto tags when autoTag option is enabled', async () => {\n    const request = {\n      jsonrpc: '2.0' as const,\n      method: 'createEntities',\n      params: {\n        entities: [\n          {\n            name: 'AI Research Lab',\n            type: 'organization',\n            observations: [\n              'Laboratory focused on artificial intelligence research',\n              'Located in Bangkok, Thailand'\n            ]\n          }\n        ],\n        options: {\n          autoTag: true\n        }\n      },\n      id: 1\n    };\n\n    const response = await server.handleJSONRPCRequest(request);\n    \n    expect(response.result).toBeDefined();\n    expect(response.result.success).toBe(true);\n    expect(response.result.data).toHaveLength(1);\n    \n    const createdEntity = response.result.data[0];\n    expect(createdEntity.autoTags).toBeDefined();\n    expect(Array.isArray(createdEntity.autoTags)).toBe(true);\n    expect(createdEntity.autoTags.length).toBeGreaterThan(0);\n    \n    // Verify tags contain expected content\n    expect(createdEntity.autoTags).toEqual(\n      expect.arrayContaining(['organization'])\n    );\n  });\n\n  test('should not generate tags when autoTag option is disabled', async () => {\n    const request = {\n      jsonrpc: '2.0' as const,\n      method: 'createEntities',\n      params: {\n        entities: [\n          {\n            name: 'Test Entity',\n            type: 'test',\n            observations: ['Test observation']\n          }\n        ],\n        options: {\n          autoTag: false\n        }\n      },\n      id: 2\n    };\n\n    const response = await server.handleJSONRPCRequest(request);\n    \n    expect(response.result).toBeDefined();\n    expect(response.result.success).toBe(true);\n    expect(response.result.data).toHaveLength(1);\n    \n    const createdEntity = response.result.data[0];\n    expect(createdEntity.autoTags).toEqual([]);\n  });\n\n  test('auto-tag service should generate tags for Thai and English text', () => {\n    const thaiResult = autoTagService.generateTags(\n      'บริษัทวิจัยปัญญาประดิษฐ์ในกรุงเทพ',\n      'organization'\n    );\n    \n    expect(thaiResult.tags).toBeDefined();\n    expect(Array.isArray(thaiResult.tags)).toBe(true);\n    expect(thaiResult.tags.length).toBeGreaterThan(0);\n    expect(thaiResult.confidence).toBeGreaterThan(0);\n    \n    const englishResult = autoTagService.generateTags(\n      'AI research company in Bangkok Thailand',\n      'organization'\n    );\n    \n    expect(englishResult.tags).toBeDefined();\n    expect(Array.isArray(englishResult.tags)).toBe(true);\n    expect(englishResult.tags.length).toBeGreaterThan(0);\n    expect(englishResult.confidence).toBeGreaterThan(0);\n  });\n});